{"title": "wellog-viz 技能优化建议", "type": "易用性改进", "scenario": "1. Readout 面板实现 : 目前实现 Readout（随鼠标移动显示数值）需要手动编写大量 DOM 操作代码 ( document.getElementById , innerHTML )，且需要手动计算 scale.invert(y) 来查找深度对应的值。\n2. 数据生成与绑定 : GraphTrack 需要特定的数据结构，如果原始数据是行式的（Row-based，如 CSV），需要手动转换成列式（Columnar）。", "pain_point": "1. 交互样板代码过多 : 仅仅为了显示一个“当前深度和数值”，开发者需要在 main.ts 中写几十行非核心的 UI 更新逻辑。这在测井应用中是极高频的需求，目前的 API 过于底层。\n2. 数据处理繁琐 : mock-utils.ts 中我们需要手动构建复杂的嵌套对象。如果能有更直观的数据绑定方式会更好。", "suggestion": "1. 内置 Readout 控件 : 建议 wellog-viz 提供一个内置的 ReadoutController 或插件。\n2. 简化 Track 配置 : 对于简单的单曲线 Track，目前的配置层级略深 ( plots: [{ type: 'line', options: { ... } }] )。\n3. Legend 自动生成 : 目前图例信息 ( legendInfo ) 需要在每个 Plot 中手动定义函数返回 { label, unit } 。建议允许在 Track 级别统一定义，或者如果 Plot ID 与数据 Key 一致，自动推导 Label。", "timestamp": "2026-01-22T16:14:44.416941"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进 / 缺陷修复", "scenario": "在使用 GraphTrack 配置多条曲线（Plots）且传入对象数组格式的数据（Row-oriented Data）时，若未显式为每个 Plot 配置 dataAccessor ，会导致内部报错 datapoints.filter is not a function 。这在“Triple Combo”等复杂场景中非常容易触发，因为用户往往希望直接传入整个数据集。", "pain_point": "目前 GraphTrack 的 Plot 默认行为似乎是直接读取 Track 的 data，而未自动处理对象数组到二维数组 [depth, value] 的转换，导致开发者必须手动为每个 Plot 写重复的 data => data.map(...) 转换函数，增加了样板代码量且容易出错。", "suggestion": "1. 文档优化 : 在 visual-patterns.md 或 examples.md 中，针对“Row Data”场景增加显式的 Warning 或 Best Practice，强调必须配合 dataAccessor 使用。\n2. 工具增强 : 建议 wellog-viz 库或技能提供一个 helper 函数（如 createDataAccessor(key) ），或者在 GraphTrack 层面增加智能推断：如果 data 是对象数组且 Plot ID 匹配 data key，自动提取对应数据列，减少手动编写 accessor 的负担。", "timestamp": "2026-01-22T17:43:49.116311"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进 / 防御性编程", "scenario": "开发者在使用 requestAnimationFrame 包裹 init() 以确保 DOM 就绪时，容易习惯性地将后续逻辑（如 overlay.create ）写在回调函数外部，导致运行时因时序问题报错。", "pain_point": "LogViewer.init() 是同步方法但依赖 DOM 尺寸，导致必须配合异步的 RAF 使用。这种“半同步半异步”的模式增加了代码结构的复杂度，且报错信息 undefined (reading 'create') 对新手不够直观。", "suggestion": "1. API 优化 : 建议让 viewer.init() 返回一个 Promise 或 this （且内部自动处理 DOM 等待），支持链式调用，例如 viewer.init(div).then(() => viewer.overlay.create(...)) 。\n2. 文档增强 : 在 Skill 的 SOP 中明确强调： 所有 依赖 viewer 实例的方法（setTracks, zoomTo, overlay）都必须严格包裹在同一个初始化闭包/回调中。", "timestamp": "2026-01-22T17:47:19.208628"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进 / 风险警示", "scenario": "在 React useEffect 中初始化 LogViewer 时，开发者通常使用 requestAnimationFrame (RAF) 来确保 DOM 节点已挂载。然而，常见的错误模式是将 viewer.init() 放在 RAF 回调中，却将 viewer.overlay.create() 或 setTracks() 放在 RAF 外部同步执行。\n此外，若不处理 useEffect 的清理函数（cleanup）来取消 RAF，在 React 严格模式（StrictMode）或快速切换路由时，会导致竞态条件，同时存在多个 Viewer 实例，引发“空白屏幕”或“闪烁”问题。", "pain_point": "1. 时序陷阱 ： viewer.init() 依赖 DOM 尺寸，必须异步等待；而 overlay 等 API 又依赖 init 完成。当前的 API 设计导致用户必须手动编写复杂的嵌套回调或 RAF 逻辑，极易出错（如本次遇到的 undefined reading 'create' ）。\n2. 竞态风险 ：缺乏内置的生命周期管理工具，开发者必须手动维护 rafId 并在组件卸载时清理，否则会造成内存泄漏和渲染异常。\n3. 数据门槛 ： GraphTrack 默认仅支持列式数据或需手动编写 dataAccessor ，对于通用的行式数据（Row-based data）缺乏自动推断支持，导致渲染不出图像且无报错。", "suggestion": "1. 工具增强 (Feature) ：建议在技能中增加一个 React Hook 封装示例（如 useLogViewer ）或通用 Helper 函数（如 LogViewer.mount(container, options) ），该函数应：\n   - 自动处理 requestAnimationFrame 等待 DOM 就绪。\n   - 返回一个 Promise ，resolve 为初始化完成的 Viewer 实例，允许用户使用 await viewer.mount(...); viewer.overlay.create(...) 的线性逻辑。\n   - 自动处理清理/销毁逻辑（dispose/destroy）。\n2. 文档优化 (Doc) ：在 BEST_PRACTICES.md 中增加“React 集成标准范式”，明确展示带有 cancelAnimationFrame 的完整代码片段，并用粗体警示“所有交互层创建必须在 init 回调内部执行”。\n3. 智能数据 (Feature) ：建议 GraphTrack 增加对 Row-based 数据的原生支持，自动识别并提取对应字段，减少 transformToColumnar 样板代码。", "timestamp": "2026-01-22T17:56:57.674962"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进 / 风险警示", "scenario": "用户在使用 React 开发时，直接在 useEffect 中同步初始化 LogViewer ，且未处理 StrictMode 的双重挂载问题，导致页面白屏。同时，若父容器未明确高度，Canvas 可能会初始化失败。", "pain_point": "videx-wellog 是基于直接 DOM 操作的，与 React 的声明式渲染和 StrictMode 机制天然冲突。开发者必须编写大量样板代码（RAF, cleanup, isActive guard）来适配。", "suggestion": "1. 提供 React Hook : 建议封装一个官方的 useLogViewer(containerRef, options) Hook，内部处理 RAF 等待、StrictMode 防抖和清理逻辑。\n2. 文档增强 : 在“Getting Started”中明确强调 React 集成的注意事项，甚至直接提供一个 ReactWrapper 组件示例。\n3. 调试工具 : 在 LogViewer 内部增加检测：如果 init(el) 被调用时 el.clientHeight 为 0，应在控制台输出警告 \"LogViewer initialized on zero-height element\"。", "timestamp": "2026-01-22T21:59:11.469120"}
{"title": "wellog-viz 技能优化建议", "type": "缺陷修复 / 风险警示", "scenario": "用户在初始化 LogViewer 时未指定 domain ，默认为 [0, 1000] 。随后通过 zoomTo 跳转到了深井段（如 4000m）。当用户触发任何交互（如滚动）时， ScaleHandler 可能会基于原始默认 domain 重新计算坐标，导致视图瞬间“弹飞”或空白，因为当前视口完全在默认范围之外。", "pain_point": "这是一个隐蔽的逻辑陷阱，开发者往往认为 zoomTo 已经设置了范围，却忽略了底层的 domain 约束。", "suggestion": "1. 防御性编程 : 建议在 wellog-viz 的 LogViewer 类中增加警告：如果 zoomTo 的范围完全超出了构造函数设定的 domain ，应在控制台输出警告 \"Zoom range is outside the configured domain. Interaction may be unstable.\"\n2. 文档强调 : 在“最佳实践”文档中加粗强调： 必须在构造函数中设置覆盖全井段的 domain ，而不仅是依赖 zoomTo 。", "timestamp": "2026-01-22T22:10:02.036468"}
{"title": "文档索引优化 / 最佳实践可发现性", "type": "文档优化 / 易用性改进", "scenario": "用户发现部分 AI 无法正确索引到最佳实践文档 (references/best-practices.md)，导致相关知识点（如 Domain 配置、React 集成）未被有效利用。", "pain_point": "关键的最佳实践（SOPs、常见陷阱）如果不能被 AI 检索到，就无法在用户遇到问题时主动提供帮助，导致重复的低级错误。", "suggestion": "评估文档结构，考虑重命名、移动或增加显式引用，以提高 AI 索引权重。", "timestamp": "2026-01-22T22:21:10.983075"}
{"title": "SKILL.md 结构优化 / 文档层级", "type": "文档优化", "scenario": "用户希望在 SKILL.md 中明确区分 \"Best Practices\" (What/Why) 和 \"High-Level Abstractions\" (How/Tools) 的定位，以便开发者更清晰地知道何时查阅哪个文档。", "pain_point": "当前文档列表只是简单的罗列，缺乏对两者关系的解释，开发者可能困惑于“最佳实践”和“高级抽象”之间的界限。", "suggestion": "在 SKILL.md 中明确两者的分工：BEST_PRACTICES.md 是“避坑指南与规范”，HIGH_LEVEL_ABSTRACTIONS.md 是“工具箱与实现”。", "timestamp": "2026-01-22T22:26:48.828014"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进", "scenario": "在使用 StackedTrack 时，遇到运行时错误 TypeError: options.data is not a function 。", "pain_point": "StackedTrack 的 data 属性必须是一个返回 Promise 的函数（例如 () => Promise.resolve(data) ），而非常规数组。这一约束在 TS 类型定义中可能不够直观（或被视为 any ），容易导致开发者直接传入数组而报错。", "suggestion": "文档/逻辑优化: 建议在 wellog-viz 的 examples.md 或常见问题中，显著标注 StackedTrack 的数据加载模式必须为异步函数。同时建议在技能输出的 StackedTrack 代码片段中默认加上 Promise.resolve 包装。", "timestamp": "2026-01-22T22:39:43.148152"}
{"title": "wellog-viz 技能优化建议", "type": "风险警示 / 最佳实践", "scenario": "用户在配置 GraphTrack 时，如果没有提供顶层 data ，而是仅在 plots 中提供 options.data ，虽然首屏渲染可能正常，但在进行缩放（Rescale）操作时会导致崩溃。", "pain_point": "库的行为不一致（Init 正常 vs Rescale 崩溃），且错误信息 undefined is not iterable 较为晦涩，难以直接定位到是 Track 数据缺失导致的。", "suggestion": "文档/逻辑优化: 在 BEST_PRACTICES.md 中增加明确警示： 禁止 仅在 Plot 级别配置数据。 GraphTrack 必须始终拥有顶层 data （即使是空数组也比 undefined 强，但最好是完整数据），并配合 dataAccessor 使用。这是保证缩放功能正常的必要条件。建议在生成代码模板时强制使用这种模式。", "timestamp": "2026-01-22T22:45:03.617431"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进 / 文档优化", "scenario": "在配置 GraphTrack 的 dataAccessor 时，开发者容易按照直角坐标系习惯传入 [x, y] 即 [Value, Depth] ，但库实际要求 [Depth, Value] ，导致图形方向完全错误且难以排查（看起来像数据压缩）。", "pain_point": "现有文档或示例未在显著位置强调坐标顺序为 [Depth, Value] ，且之前的 Core Memory 记录也是错误的，极易误导。", "suggestion": "1. 在 GraphTrack 和 dataAccessor 的文档/注释中， 加粗 提示返回值必须是 [Depth, Value] 格式。\n2. 建议在技能说明中增加“常见陷阱”章节，专门说明坐标顺序问题。\n3. （可选）工具层增加运行时警告：如果检测到第一个值的范围远大于第二个值（且与 domain 不符），可能提示用户检查坐标顺序。", "timestamp": "2026-01-29T12:29:01.598563"}
{"title": "wellog-viz 技能优化建议", "type": "缺陷修复 / 易用性改进", "scenario": "用户在 StackedTrack 中使用标准的 CSS 颜色字符串（Hex/Name），导致渲染结果为黑色。", "pain_point": "videx-wellog 的 StackedTrack 在处理颜色时没有内置颜色解析器，直接假设 color 属性是一个包含 r, g, b 的对象。这与库中其他 Track（如 GraphTrack ）支持字符串颜色的行为不一致，且在文档中未明确说明。", "suggestion": "1. 逻辑优化 ：建议在库的 StackedTrack 中增加颜色解析逻辑，或者在 wellog-viz 技能的 createSimpleTrack 工具函数中内置颜色对象转换，使用户可以直接传入 #ffffff 。 2. 文档补充 ：在 StackedTrack 的数据格式说明中，必须强调 color 属性必须是 {r: number, g: number, b: number} 格式。", "timestamp": "2026-01-29T13:28:32.142952"}
{"title": "wellog-viz 技能优化建议", "type": "缺陷修复 / 易用性改进", "scenario": "用户在 StackedTrack 中使用标准的 CSS 颜色字符串（Hex/Name），导致渲染结果为黑色。", "pain_point": "videx-wellog 的 StackedTrack 在处理颜色时没有内置颜色解析器，直接假设 color 属性是一个包含 r, g, b 的对象。这与库中其他 Track（如 GraphTrack ）支持字符串颜色的行为不一致，且在文档中未明确说明。", "suggestion": "1. 逻辑优化 ：建议在库的 StackedTrack 中增加颜色解析逻辑，或者在 wellog-viz 技能的 createSimpleTrack 工具函数中内置颜色对象转换，使用户可以直接传入 #ffffff 。 2. 文档补充 ：在 StackedTrack 的数据格式说明中，必须强调 color 属性必须是 {r: number, g: number, b: number} 格式。", "timestamp": "2026-01-29T13:41:22.102360"}
{"title": "wellog-viz 技能优化建议", "type": "缺陷修复 / 易用性改进", "scenario": "用户在 StackedTrack 中使用标准的 CSS 颜色字符串（Hex/Name），导致渲染结果为黑色。", "pain_point": "videx-wellog 的 StackedTrack 在处理颜色时没有内置颜色解析器，直接假设 color 属性是一个包含 r, g, b 的对象。这与库中其他 Track（如 GraphTrack ）支持字符串颜色的行为不一致，且在文档中未明确说明。", "suggestion": "1. 逻辑优化 ：建议在库的 StackedTrack 中增加颜色解析逻辑，或者在 wellog-viz 技能的 createSimpleTrack 工具函数中内置颜色对象转换，使用户可以直接传入 #ffffff 。 \n 2. 文档补充 ：在 StackedTrack 的数据格式说明中，必须强调 color 属性必须是 {r: number, g: number, b: number} 格式。", "timestamp": "2026-01-29T13:44:06.738434"}
{"title": "wellog-viz 技能优化建议", "type": "功能增强", "scenario": "地质绘图对颜色标准（如 SY/T 5751）有严格要求，开发者常需手动查找和硬编码色值。", "pain_point": "每次开发都需要手动维护一份代码 -> 颜色的映射表，效率低且容易出错。", "suggestion": "建议在 wellog-viz 技能中内置地质标准色卡（GeoColor Palette）常量库。例如提供 Wellog.Palettes.SYT5751 对象，允许用户直接通过 Wellog.Palettes.SYT5751['2.1'] 获取标准色值，减少重复劳动。", "timestamp": "2026-01-29T14:09:30.917895"}
{"title": "wellog-viz 技能优化建议: 岩性图案与行业色标支持", "type": "功能增强 / 易用性改进", "scenario": "用户需要实现符合地质行业标准（如 SY/T 5751）的测井图道，包含特定数字代码对应的颜色栏，以及具有行业标准花纹（泥岩划线、砂岩点状、灰岩砖块等）且宽度可变的岩性剖面图。", "pain_point": "1. wellog-viz 原生组件（如 AreaPlot）不支持填充纹理（Patterns），仅支持纯色填充。\n2. 缺乏内置的地质行业色标库，开发者需手动映射代码到颜色。\n3. LogViewer 缺乏 resize() 方法，导致布局调整时出现误用和运行时错误。\n4. 单个 AreaPlot 无法在不同深度段应用不同的填充样式（如从砂岩切换到泥岩），必须拆分为多个 Plot，增加了数据处理和配置的复杂度。", "suggestion": "1. 在 wellog-viz 核心库中集成 Canvas Pattern 支持，允许 AreaPlot 接收图案作为填充源。\n2. 提供行业标准色卡库（如 Wellog.Palettes.SYT5751），简化颜色映射逻辑。\n3. 为 LogViewer 添加 resize() 代理方法，或在文档中明确替代方案（如 adjustToSize()）。\n4. 优化 Track 数据结构，允许在单一 Plot 中定义分段样式，避免为每种岩性创建独立的 Plot 实例。", "timestamp": "2026-01-29T14:14:24.980009"}
{"title": "wellog-viz 技能优化建议", "type": "风险警示", "scenario": "组件在 DOM 容器中渲染。", "pain_point": "wellog-viz 的底层依赖 SVG 绘图，如果父容器高度未设置（或为 auto 且子元素无内容），容器高度会坍缩为 0，导致图形完全不可见且不报错。", "suggestion": "1. 文档/逻辑优化: 在 LogViewer 初始化文档中增加警告：必须确保容器 DOM 具有明确的像素高度（clientWidth/clientHeight > 0），否则可视化将无法呈现。\n2. 建议工具内置一个检测机制，当检测到容器高度为 0 时在控制台给出黄色警告。", "timestamp": "2026-01-29T14:56:07.841581"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进", "scenario": "开发者在添加轨道后忘记调用 update() 。", "pain_point": "LogViewer 在 addTrack 后不会自动重绘（可能是为了性能考虑，避免多次添加轨道导致多次重绘）。", "suggestion": "1. 文档/逻辑优化: 建议在 LogViewer 类中增加一个 autoUpdate 配置项（默认为 false ），或者在文档中显著位置提醒开发者： 所有轨道配置完成后必须调用 .update() 才能呈现内容 。", "timestamp": "2026-01-29T15:03:12.892207"}
{"title": "wellog-viz 技能优化建议", "type": "易用性改进", "scenario": "开发者在添加轨道后忘记调用 update()。", "pain_point": "LogViewer 在 addTrack 后不会自动重绘。如果开发者不显式调用 update()，内容将无法呈现。", "suggestion": "建议在文档中显著位置提醒开发者：所有轨道配置完成后必须调用 .update() 才能呈现内容。或者提供一个高层封装函数来自动处理 addTrack + update 的组合操作。", "timestamp": "2026-01-29T15:03:38.832409"}
{"title": "wellog-viz 技能优化建议: addTrack 后的 update() 调用提醒", "type": "易用性改进", "scenario": "开发者在添加轨道后忘记调用 update()。", "pain_point": "LogViewer 在 addTrack 后不会自动重绘，导致内容无法呈现，初学者难以排查。", "suggestion": "1. 在文档中显著位置提醒开发者：所有轨道配置完成后必须调用 .update() 才能呈现内容。\n2. 建议在 LogViewer 类中增加一个 autoUpdate 配置项（默认为 false）。", "timestamp": "2026-01-29T15:05:34.577548"}
{"title": "wellog-viz 技能优化建议: LogViewer 初始化顺序与 RAF 说明", "type": "易用性改进", "scenario": "初始化 LogViewer 时，开发者常因不清楚严格的执行顺序或忽略 requestAnimationFrame 导致报错。", "pain_point": "1. 缺乏明确的 RAF 代码块示例。\n2. 不清楚 viewer.init(dom) 的返回值（是否支持链式调用）。\n3. 哪些操作必须在 init 之后执行的边界不清晰。", "suggestion": "在 BEST_PRACTICES.md 中增加关于 requestAnimationFrame 的代码块示例，并明确标注 viewer.init(dom) 返回的是实例本身（支持链式调用），以及哪些操作（如 overlay/zoomTo）必须在 init 之后执行。", "timestamp": "2026-01-29T15:08:23.157314"}
{"title": "wellog-viz 技能优化建议: 零尺寸容器初始化问题", "type": "易用性改进", "scenario": "LogViewer 在宽高为 0 的容器中初始化。", "pain_point": "Canvas/SVG 会以 0 尺寸生成，且后续不会自动随容器变大而自适应（由于初始化时的内部状态绑定），导致画面始终不可见。", "suggestion": "1. 在 SKILL.md 中增加“初始化前必须确保容器 rect.width > 0 && rect.height > 0”的强提醒。\n2. 在 BEST_PRACTICES.md 中提供基于 ResizeObserver 或延迟重试的 checkAndRender 逻辑模板。", "timestamp": "2026-01-29T15:12:23.705501"}
{"title": "wellog-viz 技能优化建议: 响应式布局与 adjustToSize 持续监听", "type": "易用性改进 / 风险警示", "scenario": "用户在 CSS Grid/Flex 布局或窗口缩放场景下，容器尺寸可能发生突变。原有逻辑仅处理初始化时的单次尺寸检测，无法响应后续的动态布局调整。", "pain_point": "LogViewer 缺乏内置的自动响应式机制，开发者常忘记手动调用 adjustToSize() 或未能正确持久化监听 ResizeObserver，导致图表在布局变化后出现空白或显示异常。", "suggestion": "1. 在 BEST_PRACTICES.md 中增加响应式布局标准模式；2. 在 high-level-abstractions.md 中提供封装好的响应式初始化工具；3. 明确 adjustToSize() 的使用场景。", "timestamp": "2026-01-29T15:48:16.874505"}
{"title": "wellog-viz 技能优化建议: ScaleTrack ID 与 Label 解耦", "type": "易用性改进", "scenario": "开发者在创建 ScaleTrack 时，发现 ID 和 Label 存在耦合，为了保证 ID 唯一性（如在多个 Viewer 实例中）不得不使用复杂字符串，导致界面显示的 Label 可读性差。", "pain_point": "ScaleTrack 构造函数默认将 ID 作为显示文本，缺乏直接在 options 中覆盖显示标签的明确引导，导致 UI 显示不美观。", "suggestion": "1. 在文档中明确引导使用 options.label 或 options.title 来解耦 ID 与显示文本；2. 在 Abstractions 中提供工厂函数支持这种解耦配置。", "timestamp": "2026-01-29T17:08:07.358758"}
{"title": "wellog-viz 技能优化建议: 容器冷启动（Cold Start）渲染风险警示", "type": "风险警示", "scenario": "在高度响应式或复杂的 Grid/Flex 布局中，容器尺寸可能在 init 时为 0。LogViewer 内部无法自动处理从 0 到有值的渲染转换。", "pain_point": "LogViewer 的 Canvas/SVG 图层在初始化时如果捕获到 0 尺寸，会生成无效的渲染上下文且不会自动校准。开发者即使随后调整了布局，图表依然保持空白，必须手动调用 adjustToSize() 或在初始化前阻塞执行。", "suggestion": "1. 在 SKILL.md 增加 Cold Start 专项警示；2. 在 BEST_PRACTICES.md 细化等待尺寸就绪后再 init 的标准 SOP；3. 强调 adjustToSize() 作为唤醒手段的必要性。", "timestamp": "2026-01-29T17:25:02.855698"}
